name: build-android

on:
  push:
    branches: [main]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y git zip unzip openjdk-17-jdk python3-pip autoconf libtool pkg-config zlib1g-dev libncurses5-dev libncursesw5-dev libtinfo5 cmake libffi-dev libssl-dev

    - name: Accept Android licenses
      run: yes | sdkmanager --licenses

    - name: Install Cython
      run: |
        python3 -m pip install --upgrade pip
        python3 -m pip install --user --upgrade Cython==0.29.24 virtualenv

    - name: Install Buildozer
      run: |
        python3 -m pip install --user --upgrade buildozer

    - name: Build APK
      run: |
        buildozer -v android debug
